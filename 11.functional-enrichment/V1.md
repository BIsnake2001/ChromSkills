---
name: functional-enrichment
description: This skill should be used when users need to perform functional enrichment analysis for ChIP-seq or ATAC-seq peaks using Homer, including GO term enrichment, KEGG pathway analysis, and gene ontology analysis from BED files or gene lists.
---

# Functional Enrichment Analysis

## Overview

Perform comprehensive functional enrichment analysis for genomic peaks using Homer tools. This skill handles GO term enrichment, KEGG pathway analysis, and gene ontology analysis from BED files or gene lists, supporting multiple genome assemblies.

## Quick Start

To perform functional enrichment analysis:

1. **Input Preparation**: Provide BED files with genomic peaks or gene lists
2. **Genome Selection**: Specify genome assembly (hg38, mm10, etc.)
3. **Analysis Type**: Choose GO terms, KEGG pathways, or both
4. **Output Generation**: Generate enrichment tables and visualization-ready results

## Workflow Decision Tree

```
Input Type → Analysis Type → Output
├── BED file → GO terms → GO enrichment table
├── BED file → KEGG pathways → KEGG enrichment table
├── BED file → Both → Combined enrichment results
├── Gene list → GO terms → GO enrichment table
└── Gene list → KEGG pathways → KEGG enrichment table
```

## Input File Processing

### BED File Processing

Convert BED files to gene lists for enrichment analysis using Homer's `annotatePeaks.pl`:

```bash
# Convert BED to gene list
annotatePeaks.pl peaks.bed hg38 -annStats annotation_stats.txt > annotated_peaks.txt

# Extract gene list from annotated peaks
grep -v "^#" annotated_peaks.txt | cut -f19 | sort | uniq > gene_list.txt
```

### Gene List Processing

For existing gene lists, ensure proper formatting:
- One gene per line
- Official gene symbols
- No header lines

## GO Term Enrichment Analysis

### Using findGO.pl with Gene List

Perform GO term enrichment analysis from gene list:

```bash
# Basic GO enrichment
findGO.pl gene_list.txt hg38 > go_enrichment.txt

# GO enrichment with specific ontology
findGO.pl gene_list.txt hg38 -ontology biological_process > go_bp.txt
findGO.pl gene_list.txt hg38 -ontology molecular_function > go_mf.txt
findGO.pl gene_list.txt hg38 -ontology cellular_component > go_cc.txt

# GO enrichment with custom background
findGO.pl gene_list.txt hg38 -bg background_genes.txt > go_enrichment_custom_bg.txt
```

### Using annotatePeaks.pl with BED Files

Direct GO enrichment from BED files:

```bash
# GO enrichment directly from BED
annotatePeaks.pl peaks.bed hg38 -go go_output_dir -genomeOntology
```

## KEGG Pathway Enrichment Analysis

### Using findGO.pl for KEGG

Perform KEGG pathway enrichment analysis:

```bash
# KEGG pathway enrichment
findGO.pl gene_list.txt hg38 -kegg > kegg_enrichment.txt

# KEGG with custom background
findGO.pl gene_list.txt hg38 -kegg -bg background_genes.txt > kegg_custom_bg.txt
```

### Using annotatePeaks.pl for KEGG

Direct KEGG analysis from BED files:

```bash
# KEGG enrichment directly from BED
annotatePeaks.pl peaks.bed hg38 -kegg kegg_output_dir
```

## Supported Genome Assemblies

Homer supports multiple genome assemblies. Use the appropriate genome identifier:

- **Human**: hg38, hg19, hg18
- **Mouse**: mm10, mm9, mm8
- **Rat**: rn6, rn5
- **Zebrafish**: danRer10, danRer11
- **Drosophila**: dm6, dm3
- **C. elegans**: ce10, ce11
- **Yeast**: sacCer3

## Advanced Analysis Options

### Custom Background Gene Sets

Create custom background gene sets for more accurate enrichment:

```bash
# Generate background from all expressed genes
annotatePeaks.pl expressed_regions.bed hg38 | cut -f19 | sort | uniq > background_genes.txt

# Use custom background in enrichment
findGO.pl gene_list.txt hg38 -bg background_genes.txt > go_enrichment_custom.txt
```

### Multiple Testing Correction

Apply multiple testing correction to enrichment results:

```bash
# GO enrichment with FDR correction
findGO.pl gene_list.txt hg38 -fdr 0.05 > go_enrichment_fdr.txt
```

### Enrichment Visualization

Generate visualization-ready output:

```bash
# Generate R-compatible output
findGO.pl gene_list.txt hg38 -r > go_enrichment_r.txt

# Generate simplified output for plotting
findGO.pl gene_list.txt hg38 -simple > go_enrichment_simple.txt
```

## Quality Control and Validation

### Input Validation

Validate input files before analysis:

```bash
# Check BED file format
head -n 5 peaks.bed

# Validate gene list format
wc -l gene_list.txt
head -n 5 gene_list.txt
```

### Output Validation

Verify enrichment results:

```bash
# Check enrichment output
head -n 10 go_enrichment.txt

# Count significant terms
grep -c "^GO:" go_enrichment.txt
```

## Troubleshooting Common Issues

### Missing Gene Annotations

If genes are not being recognized:

```bash
# Check gene symbol mapping
annotatePeaks.pl test.bed hg38 -annStats test_stats.txt
```

### Low Enrichment Signal

For weak enrichment signals:
- Increase significance threshold
- Use more stringent background
- Check input gene quality

### Memory Issues

For large gene sets:
```bash
# Use simplified output
findGO.pl gene_list.txt hg38 -simple > go_simple.txt
```

## Resources

This skill includes bundled resources for efficient functional enrichment analysis:

### scripts/
- `go_enrichment.py` - Automated GO term enrichment workflow
- `kegg_enrichment.py` - KEGG pathway enrichment automation
- `bed_to_genelist.py` - BED to gene list conversion

### references/
- `homer_commands.md` - Complete Homer command reference
- `genome_assemblies.md` - Supported genome assemblies and codes
- `enrichment_interpretation.md` - Result interpretation guidelines

### assets/
- `enrichment_report_template.Rmd` - R Markdown template for results
- `go_kegg_workflow.md` - Workflow diagram reference