---
name: atac-footprinting
description: This skill performs transcription factor (TF) footprint analysis using TOBIAS on ATAC-seq data. It corrects Tn5 sequence bias, quantifies TF occupancy at motif sites, generates footprint scores, and optionally compares differential TF binding across conditions.
---

# ATAC-seq Footprint Analysis using TOBIAS

## 1. Overview
This skill performs TF footprint detection and optional differential TF binding analysis using TOBIAS. It identifies true TF occupancy by modeling depletion of Tn5 insertions at motif cores.

Main steps include:
- Refer to the **Inputs & Outputs** section to check required inputs and set up the output directory structure. 
- **Always prompt user** for genome assembly used.
- Validate input files. Required `genome.fa` can be find by `$(dirname $(which homer))/../data/genomes/${genome}/genome.fa`
- **Always prompt user** if other required files are missing.
- Tn5 bias correction with ATACorrect.
- Motif scanning.
- Footprint scoring.
- Binding detection with BINDetect.
- Aggregate footprint visualization.

---

## 2. When to use this skill

Use this skill when you need to identify transcription factor occupancy using ATAC-seq data. It is suitable for:

- Mapping TF binding events without ChIP-seq.
- Comparing TF footprint strength between conditions or cell types.
- Identifying which TFs gain or lose binding activity during differentiation or perturbation.
- Supporting integrative regulatory analyses with RNA-seq, ChIP-seq, or chromatin conformation data.

Recommended data requirements:

- Biological replicates are preferred (≥2 per condition).
- ≥30M paired-end ATAC-seq reads per sample.
- Properly aligned, duplicate-removed BAM files.
- High-quality peak calls for constraining motif scanning.

---

## 3. Inputs & Outputs

### Inputs
Required:
- ATAC-seq BAM + BAI
- Peak files (BED / narrowPeak)
- Genome FASTA + FAI
- Motif PWMs (*.jaspar)

Optional:
- Motif site BED
  - If not provided, TOBIAS will scan motifs.
- Metadata sheet
  - Only required for differential footprinting.

### Outputs
```bash
ATAC_footprint_analysis/
    01_ATACorrect/
      <sample>_corrected.bw       # bias-corrected insertion signal
      <sample>_bias_model.txt     # Tn5 bias report
      <sample>_correction.log     # logs
    02_TFBScan/
      motifs.bed                  # motif genomic coordinates
      scan.log
    03_ScoreBigwig/
      <sample>_ftprints.bw          # footprint score bigWig
      score.log
    04_BINDetect/
        <TF>_sites.bed          # bound/unbound calls per TF
        motif_activity.txt          # differential TF activity (if applicable)
        bindetect.log
    05_PlotAggregate/
        <TF>_aggregate.pdf          # aggregate footprint plots
        aggregate.log
    logs/ # all logs
    temp/ # intermediate files
```

## 4. Decision Tree

### Step 1: Validate inputs
User must confirm missing files.

### Step 2: Tn5 Bias correction
```bash
TOBIAS ATACorrect --bam <sample>.bam --genome <genome.fa> --peaks <sample>_peaks.bed --outdir 01_ATACorrect --prefix <sample> > logs/ATACorrect.log 2>&
```
### Step 3: Motif scanning
```bash
TOBIAS TFBScan --motifs <TF_NAME>.jaspar --fasta <genome>.fa --regions <sample>_peaks.bed --outdir 02_TFBScan <TF_NAME>.jaspar > logs/TFBScan.log 2>&
```
### Step 4: Footprint scoring

```bash
TOBIAS ScoreBigwig --signal 03_ScoreBigwig/<sample>_corrected.bw --regions 02_TFBScan/<TF_NAME>.bed --output <sample>_ftprints.bw --cores 8 > logs/ScoreBigwig.log 2>&
```

### Step 5: Binding detection

(1) Single condition
```bash
TOBIAS BINDetect --signals 03_ScoreBigwig/<sample>_ftprints.bw --peaks <sample>_peaks.bed --motifs <TF_NAME>.jaspar --genome <genome>.fa --outdir 04_BINDetect > logs/BINDetect.log 2>&
```
(2) Two conditions (differential TF activity)
```bash
TOBIAS BINDetect \
    --signals 03_ScoreBigwig/condition1_ftprints.bw 03_ScoreBigwig/condition2_ftprints.bw \
    --peaks <merged_peaks>.bed \
    --motifs <TF_NAME>.jaspar \
    --genome <genome>.fa \
    --outdir 04_BINDetect > logs/BINDetect.log 2>&
```

### Step 6: Aggregate plots
```bash
TOBIAS PlotAggregate --signals 03_ScoreBigwig/<sample>_ftprints.bw --TFBS 04_BINDetect/<TF>/beds/<TF>_sites.bed --motifs <TF_NAME>.jaspar --flank 70 --plot_boundaries --output 05_PlotAggregate/<TF_NAME>_agg_ftprints.pdf > logs/PlotAggregate.log 2>&
TOBIAS PlotAggregate --signals 01_ATACorrect/<sample>_corrected.bw --TFBS 04_BINDetect/<TF>/beds/<TF>_sites.bed --motifs <TF_NAME>.jaspar --flank 70 --plot_boundaries --output 05_PlotAggregate/<TF_NAME>_agg_atac_signals.pdf >> logs/PlotAggregate.log 2>&
... # add other plots if generated by BINDetect
```

## Advanced Usage

- Merged peaks for condition-wide scanning
- Flank window can be adjusted for large or small motifs.
- Add blacklist parameter if the .blacklist file is provided.