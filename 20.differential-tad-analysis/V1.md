---
name: differential-tad-analysis
description: This skill performs differential topologically associating domain (TAD) analysis from Hi-C data using HiCExplorer. It identifies changes in TAD boundaries, insulation scores, and domain sizes between experimental conditions, providing comprehensive statistical comparisons and visualizations.
---

# Differential TAD Analysis with HiCExplorer

## Overview

This skill enables systematic comparison of chromatin architecture between experimental conditions by analyzing differences in topologically associating domains (TADs). It supposes that the TAD has been called before and provides workflows for TAD calling, differential boundary analysis, and comparative visualization using HiCExplorer tools.

## When to Use This Skill

Use this skill when:
- Comparing chromatin organization between cell types, treatments, or developmental stages
- Analyzing changes in TAD boundaries and insulation scores
- Investigating differential chromatin architecture in disease vs. normal conditions
- Working with Hi-C data in .mcool format
- Need comprehensive statistical analysis of TAD differences

## Quick Start Workflow

### 1. TAD Calling for Each Condition

Perform TAD calling separately for each experimental condition using the provided script:

```bash
python scripts/tad_calling.py --mcool condition1.mcool --output_prefix cond1_tads
python scripts/tad_calling.py --mcool condition2.mcool --output_prefix cond2_tads
```

### 2. Differential Analysis

Compare TAD boundaries and domains between conditions:

```bash
python scripts/differential_tad_analysis.py \
    --condition1_boundaries cond1_tads_boundaries.bed \
    --condition2_boundaries cond2_tads_boundaries.bed \
    --condition1_domains cond1_tads_domains.bed \
    --condition2_domains cond2_tads_domains.bed \
    --output_prefix differential_results
```

### 3. Visualization

Generate comparative plots:

```bash
python scripts/visualization.py \
    --common_boundaries differential_results_common_boundaries.tsv \
    --condition1_specific differential_results_condition1_specific_boundaries.tsv \
    --condition2_specific differential_results_condition2_specific_boundaries.tsv \
    --condition1_domains cond1_tads_domains.bed \
    --condition2_domains cond2_tads_domains.bed \
    --output_prefix differential_plots
```

## Detailed Workflow

### TAD Calling Parameters

The `tad_calling.py` script provides configurable parameters for optimal TAD detection:

```bash
python scripts/tad_calling.py \
    --mcool input.mcool \
    --output_prefix output_prefix \
    --resolution 10000 \
    --min_depth 30000 \
    --max_depth 100000 \
    --step 10000 \
    --threshold_comparisons 0.05 \
    --delta 0.01 \
    --correct_for_multiple_testing fdr \
    --min_boundary_distance 40000 \
    --number_of_processors 8
```

**Recommended Parameters:**
- **Mammalian genomes**: resolution=10000, min_depth=30000, max_depth=100000
- **Drosophila/Yeast**: resolution=5000, min_depth=10000, max_depth=50000
- **High-resolution data**: resolution=5000, min_depth=20000, max_depth=80000

### Differential Analysis Options

The `differential_tad_analysis.py` script supports flexible comparison:

```bash
python scripts/differential_tad_analysis.py \
    --condition1_boundaries cond1_boundaries.bed \
    --condition2_boundaries cond2_boundaries.bed \
    --condition1_domains cond1_domains.bed \
    --condition2_domains cond2_domains.bed \
    --output_prefix results \
    --window_size 50000
```

**Window Size Considerations:**
- **50kb**: Standard for mammalian genomes
- **25kb**: For higher resolution data
- **100kb**: For lower resolution or sparse data

## Output Interpretation

### Generated Files

**TAD Calling Output:**
- `{prefix}_domains.bed`: TAD domains in BED format
- `{prefix}_boundaries.bed`: TAD boundaries with statistical information
- `{prefix}_boundary_strength.bedgraph`: Boundary strength scores
- `{prefix}_tad_score.bedgraph`: TAD insulation scores

**Differential Analysis Output:**
- `{prefix}_common_boundaries.tsv`: Boundaries present in both conditions
- `{prefix}_condition1_specific_boundaries.tsv`: Unique to condition 1
- `{prefix}_condition2_specific_boundaries.tsv`: Unique to condition 2
- `{prefix}_boundary_strength_changes.tsv`: Strength differences
- `{prefix}_summary_statistics.tsv`: Overall comparison metrics

**Visualization Output:**
- `{prefix}_boundary_comparison.png`: Boundary strength correlation and distributions
- `{prefix}_tad_size_comparison.png`: TAD size distribution comparison
- `{prefix}_specific_boundaries.png`: Condition-specific boundary analysis

### Interpretation Guidelines

**Common Boundaries:**
- Strength differences >0.1 may indicate significant changes
- Consider genomic context (gene-rich regions, enhancers)
- Correlate with gene expression or epigenetic marks

**Condition-Specific Boundaries:**
- May indicate major chromatin reorganization
- Check for enrichment in specific genomic features
- Consider biological relevance and sample quality

**TAD Size Changes:**
- Mean size differences >20% may be significant
- Correlate with cell type-specific chromatin organization
- Consider technical factors (sequencing depth, normalization)

## Quality Control

### Pre-analysis Checks
- Verify .mcool file integrity and resolution
- Ensure comparable sequencing depth between conditions
- Check matrix normalization status

### Post-analysis Validation
- Boundary strength distributions should be reasonable
- TAD sizes should follow expected distributions
- Specific boundaries should be distributed across chromosomes

## Resources

### Scripts
- `scripts/tad_calling.py`: Perform TAD calling from .mcool files
- `scripts/differential_tad_analysis.py`: Compare TAD boundaries between conditions
- `scripts/visualization.py`: Generate comparative plots

### References
- `references/hicexplorer_workflows.md`: Detailed HiCExplorer workflows and troubleshooting

### Required Dependencies
- HiCExplorer (hicFindTADs)
- Python 3.7+ with pandas, numpy, matplotlib, seaborn
- Sufficient memory for large Hi-C matrices

## Troubleshooting

### Common Issues

**No TADs Found:**
- Check matrix resolution and depth parameters
- Verify matrix quality and normalization
- Try different minDepth/maxDepth values

**Poor Boundary Correlation:**
- Ensure comparable sequencing depth between conditions
- Check for technical batch effects
- Verify matrix normalization

**Too Many/Few TADs:**
- Adjust thresholdComparisons parameter
- Modify minBoundaryDistance
- Check matrix quality and sequencing depth

For detailed troubleshooting and advanced workflows, consult the reference documentation in `references/hicexplorer_workflows.md`.
