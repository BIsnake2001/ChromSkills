---
name: ATACseq-QC
description: This skill should be used when users need to perform comprehensive quality control for ATAC-seq data using ataqv and other QC tools. It provides workflows for read distribution analysis, fragment size distribution, TSS enrichment, library complexity assessment, and generation of interactive QC reports.
---

# ATAC-seq Quality Control with ataqv

## Overview

Perform comprehensive quality control analysis for ATAC-seq data using ataqv toolkit and complementary QC tools. Generate interactive reports, assess data quality metrics, and identify potential issues in ATAC-seq libraries.

## Quick Start

To perform basic ATAC-seq QC analysis:

1. **Prepare BAM files**: Ensure BAM files are properly sorted and indexed
2. **Check available peak files**: Use `--peak-file` as optinal input if the corresponding peak files are available
3. **Prepare annoatation files**: All the annotation files are available at `$(dirname $(which homer))/../data/genomes/${genomes used}`, the `${genome used}` can either be inferred from the BAM file or parsed by user
2. **Run ataqv analysis**: Generate metrics and JSON output
3. **Create HTML report**: Convert JSON to interactive HTML report
4. **Generate summary**: Extract key quality metrics

Example workflow:
```bash
# Run ataqv on a single BAM file
ataqv --peak-file peaks/sample.narrowPeak --metrics-file metrics.json --tss-file tss.bed {organism} sample.bam

# Generate HTML report
mkarv report.html metrics.json

# Generate summary statistics
ataqv show metrics.json
```

## Core Workflows

### 1. Single Sample QC Analysis

Perform comprehensive QC analysis for individual ATAC-seq samples:

**Required Inputs:**
- Sorted and indexed BAM file (.bam + .bai)
- Reference genome TSS annotations (BED format)
- Optional: Blacklist regions (BED format)

**Workflow Steps:**
1. Run ataqv with TSS annotations
2. Generate interactive HTML report
3. Extract key quality metrics
4. Assess data quality against ATAC-seq standards

**Example Commands:**
```bash
# Basic ataqv analysis
ataqv --peak-file peaks/sample.narrowPeak --metrics-file sample_metrics.json --tss-file hg38_tss.bed {organism} sample.bam

# With blacklist filtering
ataqv --peak-file peaks/sample.narrowPeak --metrics-file sample_metrics.json --tss-file hg38_tss.bed --blacklist hg38_blacklist.bed {organism} sample.bam

# Generate HTML report
mkarv report.html sample_metrics.json

# View summary metrics
ataqv show sample_metrics.json
```

### 2. Multi-Sample Comparative Analysis

Compare QC metrics across multiple ATAC-seq samples:

**Required Inputs:**
- Multiple BAM files from different samples/conditions
- Common TSS annotations
- Sample metadata (optional)

**Workflow Steps:**
1. Run ataqv on all samples
2. Combine metrics into single JSON file
3. Generate comparative HTML report
4. Assess sample-to-sample variability

**Example Commands:**
```bash
# Run ataqv on multiple samples
for bam in *.bam; do
    sample=$(basename $bam .bam)
    ataqv --peak-file peaks/${sample}.narrowPeak --metrics-file ${sample}_metrics.json --tss-file hg38_tss.bed $bam
done

# Combine metrics
ataqv merge combined_metrics.json *_metrics.json

# Generate comparative report
mkarv multi_sample_report.html combined_metrics.json
```

## Key Quality Metrics

### Essential ATAC-seq QC Metrics

**Read Distribution:**
- Total reads
- Mapped reads (%)
- Properly paired reads (%)
- Duplicate rate (%)
- Mitochondrial reads (%)

**Fragment Size Distribution:**
- Nucleosome-free fragments (<150 bp)
- Mononucleosome fragments (180-247 bp)
- Dinucleosome fragments (315-437 bp)
- Fragment length periodicity

**TSS Enrichment:**
- TSS enrichment score
- TSS coverage profile
- Promoter accessibility

**Library Complexity:**
- Non-redundant fraction (NRF)
- PCR bottleneck coefficient (PBC)

### Quality Thresholds

**Excellent Quality:**
- TSS enrichment > 10
- NRF > 0.8
- Duplicate rate < 20%
- Mitochondrial reads < 20%

**Good Quality:**
- TSS enrichment > 5
- NRF > 0.5
- Duplicate rate < 50%
- Mitochondrial reads < 50%

## Troubleshooting Common Issues

### High Mitochondrial Reads
- **Issue**: >50% mitochondrial reads
- **Cause**: Insufficient nuclei isolation or cell lysis
- **Solution**: Optimize nuclei preparation protocol

### Low TSS Enrichment
- **Issue**: TSS enrichment < 5
- **Cause**: Poor chromatin accessibility or over-digestion
- **Solution**: Optimize transposition time and conditions

### High Duplicate Rate
- **Issue**: Duplicate rate > 50%
- **Cause**: Insufficient sequencing depth or PCR over-amplification
- **Solution**: Increase sequencing depth, reduce PCR cycles

### Abnormal Fragment Distribution
- **Issue**: Missing nucleosome periodicity
- **Cause**: Over-digestion or poor library quality
- **Solution**: Optimize transposition conditions

## Resources

### Scripts Directory
Executable scripts for automated ATAC-seq QC workflows:

- `generate_qc_report.py`: Generate comprehensive QC reports
- `extract_metrics.py`: Extract and tabulate key metrics

### References Directory
Detailed documentation and reference materials:

- `ataqv_manual.md`: Complete ataqv tool documentation
- `atacseq_qc_standards.md`: ATAC-seq quality standards and thresholds
- `troubleshooting_guide.md`: Common issues and solutions

### Assets Directory
Templates and configuration files:

- `report_templates/`: HTML report templates for customization
- `qc_configs/`: Configuration files for different QC workflows
